var getUA = require('../compiled/common/get-ua').internal;
var assert = require('assert');

var cases = [
// Meituan
   {
     name: 'meituan-ios',
     input: 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_3_5 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13G36 KNB/1.0.0 iOS/9.3.5 meituangroup/7.2.0',
     output: {
       appName: 'meituan',
       appVersion: '7.2.0',
       osName: 'ios',
       osVersion: '9.3.5'
     }
   },
   {
     name: 'meituan-android',
     input: 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_3_5 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13G36 MTNB/0.0.1 (Meituan 1005)',
     url: 'http://board.meishi.meituan.com/board/list?version_name=6.8&ci=10&utm_term=6.8&utm_content=F42727FF0B5D710255C45DC44716C0D4F1C5CB7C9F93514536005F4EC63B0B01&utm_source=Alpha&utm_campaign=AgroupBgroupGhomepage_category1_1__a1__gfood__hrecommend__i0H0&utm_medium=iphone&uuid=F42727FF0B5D710255C45DC44716C0D4F1C5CB7C9F93514536005F4EC63B0B01&msid=DF0AD867-197E-4EA6-ADD9-C513FD35F17B2016-06-08-11-53555&f=iphone&_sr=fooddiscovery',
     output: {
       appName: 'meituan',
       appVersion: '6.8',
       osName: 'ios',
       osVersion: '9.3.5'
     }
   },

// Meituan Legacy
  {
    name: 'meituan-android',
    input: 'Mozilla/5.0 (Linux; Android 5.1; PRO 5 Build/LMY47D) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/40.2214.121 Mobile Safari/537.36 KNB/1.1.0 Android/5.1 MeituanGroup/7.3.1',
    output: {
      appName: 'meituan',
      appVersion: '7.3.1',
      osName: 'android',
      osVersion: '5.1'
    }
  },

// Meituan Titans - iOS
{
  name: 'meituan-android',
  input: 'Mozilla/5.0 (iPad; CPU OS 10_0_2 like Mac OS X) AppleWebKit/602.1.50 (KHTML, like Gecko) Mobile/14A456 TitansX/1.0.0 KNB/1.0.0 iOS/10.0.2 meituan/com.meituan.imeituan-beta/7.6.0',
  output: {
    appName: 'meituan',
    appVersion: '7.6.0',
    osName: 'ios',
    osVersion: '10.0.2'
  }
},

// Dianping
   {
     name: 'dianping-ios',
     input: 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_3_5 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13G36 KNB/1.0.0 iOS/9.3.5 dp/com.dianping.dpscope/9.0.0',
     output: {
       appName: 'dianping',
       appVersion: '9.0.0',
       osName: 'ios',
       _knbVersion: '1.0.0',
       osVersion: '9.3.5'
     }
   },
   {
     name: 'dianping-android',
     input: 'Mozilla/5.0 (Linux; Android 5.1; PRO 5 Build/LMY47D) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/40.2214.121 Mobile Safari/537.36 KNB/1.0.0 android/5.1 dp/com.dianping.v1/9.0.0',
     output: {
       appName: 'dianping',
       appVersion: '9.0.0',
       osName: 'android',
       _knbVersion: '1.0.0',
       osVersion: '5.1'
     }
   },

// maoyan
  {
    name: 'maoyan-ios',
    input: 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_3_5 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13G36 movie/7.2/812 MTNB/1.0.0 (iOS; Maoyan 812)  ',
    output: {
      appName: 'maoyan',
      appVersion: '7.2',
      osName: 'ios',
      osVersion: '9.3.5'
    }
  },
  {
    name: 'maoyan-android',
    input: 'Mozilla/5.0 (Linux; Android 5.1; PRO 5 Build/LMY47D) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/40.2214.121 Mobile Safari/537.36 movie/7.2.0/7201',
    output: {
      appName: 'maoyan',
      appVersion: '7.2.0',
      osName: 'android',
      osVersion: '5.1'
    }
  },

// maoyanpro
  {
    name: 'maoyanpro-ios',
    input: 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_3_5 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13G36 MTNB/1.0.0 (iOS; moviepro 450)',
    output: {
      appName: 'maoyanpro',
      appVersion: '450',
      osName: 'ios',
      osVersion: '9.3.5'
    }
  },
  {
    name: 'maoyanpro-android',
    input: 'Mozilla/5.0 (Linux; Android 5.1; PRO 5 Build/LMY47D) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/40.2214.121 Mobile Safari/537.36 MTNB/0.0.1 com.sankuai.moviepro/Android/2.1.0',
    output: {
      appName: 'maoyanpro',
      appVersion: '2.1.0',
      osName: 'android',
      osVersion: '5.1'
    }
  },

// wechat
  {
    name: 'wechat-ios',
    input: 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_3_5 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13G36 MicroMessenger/6.3.25 NetType/WIFI Language/en',
    output: {
      appName: 'wechat',
      appVersion: '6.3.25',
      osName: 'ios',
      osVersion: '9.3.5'
    }
  },
  {
    name: 'wechat-android',
    input: 'Mozilla/5.0 (Linux; Android 5.1; PRO 5 Build/LMY47D) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile MQQBrowser/6.2 TBS/036556 Safari/537.36 MicroMessenger/6.3.25.861 NetType/WIFI Language/zh_CN',
    output: {
      appName: 'wechat',
      appVersion: '6.3.25.861',
      osName: 'android',
      osVersion: '5.1'
    }
  },

// qq
  {
    name: 'qq-ios',
    input: 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_3_5 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13G36 QQ/6.5.3.410 V1_IPH_SQ_6.5.3_1_APP_A Pixel/750 Core/UIWebView NetType/WIFI Mem/93',
    output: {
      appName: 'qq',
      appVersion: '6.5.3.410',
      osName: 'ios',
      osVersion: '9.3.5'
    }
  },


// daxiang
  {
    name: 'daxiang-ios',
    input: 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_3_5 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13G36 XM/4.3.2.318',
    output: {
      appName: 'daxiang',
      appVersion: '4.3.2.318',
      osName: 'ios',
      osVersion: '9.3.5'
    }
  },
]

describe('ua', function () {

  cases.forEach(function (caze, i) {
    it('should pass #' + (caze.name || i), function () {
      global.navigator = {
        userAgent: caze.input
      };
      global.location = caze.url ? require('url').parse(caze.url) : {href: '', search: ''};
      var uaInfo = getUA();
      assert.deepEqual(caze.output.appName, uaInfo.appName);
      assert.deepEqual(caze.output.appVersion, uaInfo.appVersion);
      assert.deepEqual(caze.output.osName, uaInfo.osName);
      assert.deepEqual(caze.output.osVersion, uaInfo.osVersion);
      if (caze.output._knbVersion) assert.deepEqual(caze.output._knbVersion, uaInfo._knbVersion);
    });
  });
});
