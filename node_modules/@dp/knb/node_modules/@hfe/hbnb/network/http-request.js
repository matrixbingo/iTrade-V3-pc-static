'use strict';

var P = require('pinkie-promise');
var cc = require('../utils/call_callback');

var network = {
    /**
     * 代理网络请求
     * @memberof network
     * @example
     *
     *  hbnb.network.request({
     *      method: 'get',
     *      url: '',
     *      timeout: 5000, // ms
     *      insecure: true, // 跳过 https 认证
     *  })
     *  .then(function(data) {
     *      console.log(data);
     *      // { status: 200, responseText: '', responseHeader: {} }
     *  })
     *  .catch(function(err) {
     *      console.log(err);
     *      // { status: -1, message: '网络错误' }
     *  });
     */
    request: function(options) {
        var that = this.bridge;
        return new P(function(resolve, reject) {
            var cb = options.callback;
            options.callback = function(data) {
                resolve(data);
                cc(cb, data);
            };

            var eb = options.errback;
            options.errback = function(data) {
                reject(data);
                cc(eb, data);
            };

            that.push('magpie://network/http_request', options);
        });
    }
};

module.exports = network;
