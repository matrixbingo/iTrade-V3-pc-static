'use strict';

var debug;
if (process.env.NODE_ENV !== 'production') {
    debug = require('debug')('hbnb:module:flight:alipay');
}

var _invoke = require('../invoke');

/**
 * 调用支付宝客户端
 *
 * @memberof flight
 * @static
 * @name alipay
 * @param {String} orderId
 * @param {String} payURL
 * @param {String} returnURL
 * @return {Promise<orderId>}
 * @example
 *  hbnb.flight.alipay(
 *      orderId: '123',
 *      payURL: '456',
 *      returnURL: '789'
 *  ).then(function(orderId) {
 *  }).catch(function() {
 *  });
 */
module.exports = function(orderId, payURL, returnURL) {
    if (process.env.NODE_ENV !== 'production') {
        debug('orderId is %s', orderId);
        debug('payURL is %s', payURL);
        debug('returnURL is %s', returnURL);
    }

    var p = new Promise(function(resolve, reject) {
        _invoke('flight', 'pay_alipay', {
            orderId: orderId,
            payURL: payURL,
            returnURL: returnURL,
            callback: function(data) {
                if (data && data.isPayed) {
                    resolve(data.orderId);
                } else {
                    reject();
                }
            }
        });
    });
    return p;
};
